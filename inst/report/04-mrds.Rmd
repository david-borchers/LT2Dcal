# Mark Recapture Distance Sampling

```{r, include = FALSE}
#set up
source("code.R")
Nanimals = 200
hr_param = c(0.8,6) #parameters for detection function
match_limits = c(0.1,0.5)
match_param = c(0.15, 2.5)

```

## Introduction

Mark Recapture Distance Sampling (MRDS) combines the principles of mark-recapture and standard distance sampling. 2 observers each travel along the same transect and record the animals they see and the perpendicular distance. By including the capture history of each animal we have enough information to allow for non-zero detection probability on the line, but we lose the pooling robustness property, so unmodelled heterogeneity will cause biased estimates. This model also assumes that the observers perfectly match which animals they both saw and which ones only one observer saw. If the animals don't have uniquely identifying features and there is any kind of animal movement then this assumption will not hold. 
##Simulation - p(0) < 1 and animal movement
### Methods
To test the mrds estimator, we simulated `r Nanimals` animals with a uniform distribution across the study area and simulated an observer detecting animals with a hazard rate detection function with sigma = `r hr_param[1]`, beta = `r hr_param[2]`, scaled by 0.8 to see the affect of p(0) < 1. We then had the animals move away in response to the observer with three levels of avoidance, and simulated the second observer detecting the animals in their new positions with the same detection function as the first observer.
```{r, echo= F, warning=FALSE, fig.cap="Bias for different levels of animal avoidance"}
p0.bias <- get_p0_bias(50,200) #make reps higher 
plot(p0.bias,pch = 16, xlab = "", ylab = "% Bias")
abline(h = 0, col = "blue", type = "--")
legend("bottom", inset=c(0,-0.4), legend=c("No", "Low","Medium", "High"), title="Avoidance", horiz = T, xpd = T)
```
### Results
As expected, the mrds estimator is unbiased for p(0) < 1 when there is no animal movement and no heterogeneity in the population. However, this may not be realistic for most situations. The estimate becomes more negatively biased as the animals move more as a result of the increasing difference in detectability between the two occasions.  
This method also assumes that the observers can identify an individual animal regardless of how far it moves. We investigate the impact of violating this assumption in the next simulation.
## Simulation - Imperfect Matching
### Methods
To see the affect of imperfect matching, we simulated `r Nanimals` animals and had them move in the same way as before. We used the same detection function but did not multiply by 0.8 (i.e. kept p(0) = 1). 

```{r,echo = FALSE, out.width='50%', fig.asp=1.25, fig.margin = TRUE, fig.cap='Demonstration of different avoidance levels'}
avoidance_demo(Nanimals, 1)
```
To account for the imperfect matching we set that any animals detected on the second occasion within `r match_limits[1]` of an animal detected on the first animal were recorded as the same animal, taking the closest as the match if there were multiple within this range. Any animals further than `r match_limits[2]` were recorded as different, and generated the probability of matching animals within the range using a hazard rate with parameters `r match_param`. 
```{r out.width='50%', echo = FALSE, fig.cap = 'Probability of matching animals as distance between them increase'}
x <- seq(0,match_limits[2],0.01)
plot(x, hazard_rate(x-match_limits[1],match_param[1],match_param[2]), xlab = "Distance from 1st animal", ylab = "Probability of Match", type = "l")
```
```{r, include=FALSE, warning=FALSE}
#takes ~25 seconds to run one repetition
bias <- get_bias(99, Nanimals)
```
We fitted a half normal mrds model and a hazard rate mrds model to this data and selected the best using AIC, and repeated this process 999 times to estimate bias.   

### Results
The MRDS estimator is unbiased for perfect matching and no movement as there is no unmodelled heterogeneity in the population. It isn't significantly biased for scenarios with responsive movement and perfect matching, with an average bias of `r mean(bias[3,5,7])`% across the 3 levels of movement. It is slightly positively biased due to the second observer being able to see less animals than the first as a result of the avoidance. This leads to underestimating the detection probability and so overestimating the abundance. 

However, when we add imperfect matching the estimator becomes significantly positively biased. The bias increases as the animals become more avoidant as it becomes more likely that the observers will make a mismatch as the animals move more. More individuals that were truly seen on both occasions are misidentified as two separate animals that were seen once each on each occasion as the animals avoid the line more. This results in a severe underestimate of the detection probability and so the estimate of abundance is significantly positively biased. 
```{r echo = FALSE}
par(xpd = T)
plot(bias[c(1,3,5,7)], ylim = c(-10,100), pch = c(15,16,17,18), main = "Bias by scenario", ylab = "% bias", xlab = "", xaxt = "n")
points(bias[c(2,4,6,8)],pch = c(15,16,17,18), col = "red")
legend("bottom", inset=c(0,-0.4), legend=c("No", "Low","Medium", "High"), pch=c(15,16,17,18), title="Avoidance", horiz = T, xpd = T)
legend("topright", legend = c("Perfect Matching", "Imperfect Matching"), col = c("black", "red"), pch = 16)
```
## Futher Reading
Buckland, S.T., Rexstad, E.A., Marques, T.A. and Oedekoven, C.S. (2015). Distance Sampling: Methods and Applications. Springer International Publish, pp.99â€“103.
